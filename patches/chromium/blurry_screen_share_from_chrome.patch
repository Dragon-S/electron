From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: lorne <lorne.shi@gmail.com>
Date: Tue, 30 May 2023 17:36:29 +0800
Subject: Blurry screen share from Chrome
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

详细信息如下：
https://github.com/cisco/openh264/pull/3638

https://bugs.chromium.org/p/chromium/issues/detail?id=1427946

diff --git a/build/linux/unbundle/openh264.gn b/build/linux/unbundle/openh264.gn
index 1a19ceed0b04cf72046d4f9259b824ea3f5d9745..f4abd9b5f7b799aa4e0238c963220d80e6414f7b 100644
--- a/build/linux/unbundle/openh264.gn
+++ b/build/linux/unbundle/openh264.gn
@@ -11,7 +11,7 @@ pkg_config("config") {
 
 shim_headers("openh264_shim") {
   prefix = "wels/"
-  root_path = "src/codec/api/svc"
+  root_path = "src/codec/api/wels"
   headers = [
     "codec_api.h",
     "codec_app_def.h",
diff --git a/media/DEPS b/media/DEPS
index 605f574a59163339ed1d01d0d7680b99e699762e..671ab2104ccbb8bed369e979f1a6cea89ee10756 100644
--- a/media/DEPS
+++ b/media/DEPS
@@ -22,7 +22,7 @@ include_rules = [
   "+third_party/libgav1",
   "+third_party/libvpx",
   "+third_party/libyuv",
-  "+third_party/openh264/src/codec/api/svc",
+  "+third_party/openh264/src/codec/api/wels",
   "+third_party/opus",
   "+third_party/skia",
   "+ui/base/x/x11_user_input_monitor.h",
diff --git a/media/video/openh264_video_encoder.h b/media/video/openh264_video_encoder.h
index 09f4922a672f334da3571a87a599d47b8be5e135..9d70cc31ddb38c69a03b58cd436044802cbad014 100644
--- a/media/video/openh264_video_encoder.h
+++ b/media/video/openh264_video_encoder.h
@@ -12,7 +12,7 @@
 #include "media/base/video_encoder.h"
 #include "media/base/video_frame_pool.h"
 #include "media/formats/mp4/h264_annex_b_to_avc_bitstream_converter.h"
-#include "third_party/openh264/src/codec/api/svc/codec_api.h"
+#include "third_party/openh264/src/codec/api/wels/codec_api.h"
 #include "ui/gfx/geometry/size.h"
 
 namespace media {
diff --git a/third_party/blink/renderer/modules/mediarecorder/DEPS b/third_party/blink/renderer/modules/mediarecorder/DEPS
index 031509e33c922addb356332234be5843697ab4c6..ce6d546fafe63a8ad63fa861c2eb1eba6ed83c3a 100644
--- a/third_party/blink/renderer/modules/mediarecorder/DEPS
+++ b/third_party/blink/renderer/modules/mediarecorder/DEPS
@@ -18,7 +18,7 @@ include_rules = [
     '+third_party/opus',
     "+third_party/libvpx",
     "+third_party/libyuv",
-    "+third_party/openh264/src/codec/api/svc",
+    "+third_party/openh264/src/codec/api/wels",
     "+ui/gfx/geometry",
 ]
 
diff --git a/third_party/blink/renderer/modules/mediarecorder/h264_encoder.cc b/third_party/blink/renderer/modules/mediarecorder/h264_encoder.cc
index 1e0d1f03fa5bb40c998343249686566d159778c6..7c0aaea323f7bab8dc48f6b49bc114c05b8ce9cf 100644
--- a/third_party/blink/renderer/modules/mediarecorder/h264_encoder.cc
+++ b/third_party/blink/renderer/modules/mediarecorder/h264_encoder.cc
@@ -20,8 +20,8 @@
 #include "third_party/blink/renderer/platform/wtf/functional.h"
 #include "third_party/blink/renderer/platform/wtf/hash_map.h"
 #include "third_party/blink/renderer/platform/wtf/vector.h"
-#include "third_party/openh264/src/codec/api/svc/codec_app_def.h"
-#include "third_party/openh264/src/codec/api/svc/codec_def.h"
+#include "third_party/openh264/src/codec/api/wels/codec_app_def.h"
+#include "third_party/openh264/src/codec/api/wels/codec_def.h"
 #include "ui/gfx/geometry/size.h"
 
 using media::VideoFrame;
diff --git a/third_party/blink/renderer/modules/mediarecorder/h264_encoder.h b/third_party/blink/renderer/modules/mediarecorder/h264_encoder.h
index 7eb18a124e09c9a4c4552631528367f760cd508b..6dadffcb7b452eb6b0452e5152d0099ad770511e 100644
--- a/third_party/blink/renderer/modules/mediarecorder/h264_encoder.h
+++ b/third_party/blink/renderer/modules/mediarecorder/h264_encoder.h
@@ -14,7 +14,7 @@
 
 #include "base/time/time.h"
 #include "third_party/blink/renderer/modules/mediarecorder/video_track_recorder.h"
-#include "third_party/openh264/src/codec/api/svc/codec_api.h"
+#include "third_party/openh264/src/codec/api/wels/codec_api.h"
 
 namespace blink {
 
diff --git a/third_party/openh264/README.chromium b/third_party/openh264/README.chromium
index 599e7d4fd702382758c8078d1dc528d2ecf01df3..a877a922392e10ab32935e07a4374345f1af1782 100644
--- a/third_party/openh264/README.chromium
+++ b/third_party/openh264/README.chromium
@@ -3,7 +3,7 @@ Short Name: openh264
 URL: http://www.openh264.org/
 Version: unknown
 CPEPrefix: cpe:/a:cisco:openh264:2.1.1
-(Cut at 3dd5b80bc4f172dd82925bb259cb7c82348409c5, which is 2.1.1)
+(Cut at db956674bbdfbaab5acdd3fdb4117c2fef5527e9, which is 2.3.0)
 License: 2-Clause BSD
 License File: src/LICENSE
 Security Critical: yes
diff --git a/third_party/openh264/openh264_sources.gni b/third_party/openh264/openh264_sources.gni
index e714dad9ef7bda6d0f9dd7c05ff2934e93333e6e..01d06ebcd46398e11b9821416fed61fa4bccccfc 100644
--- a/third_party/openh264/openh264_sources.gni
+++ b/third_party/openh264/openh264_sources.gni
@@ -1,6 +1,6 @@
 # Common
 openh264_common_include_dirs = [
-  "//third_party/openh264/src/codec/api/svc",
+  "//third_party/openh264/src/codec/api/wels",
   "//third_party/openh264/src/codec/common/arm",
   "//third_party/openh264/src/codec/common/inc",
   "//third_party/openh264/src/codec/common/src",
@@ -87,7 +87,7 @@ openh264_common_sources_asm_arm64 = [
 
 # Processing
 openh264_processing_include_dirs = [
-  "//third_party/openh264/src/codec/api/svc",
+  "//third_party/openh264/src/codec/api/wels",
   "//third_party/openh264/src/codec/common/arm",
   "//third_party/openh264/src/codec/common/inc",
   "//third_party/openh264/src/codec/common/src",
@@ -164,7 +164,7 @@ openh264_processing_sources_asm_arm64 = [
 
 # Encoder
 openh264_encoder_include_dirs = [
-  "//third_party/openh264/src/codec/api/svc",
+  "//third_party/openh264/src/codec/api/wels",
   "//third_party/openh264/src/codec/common/arm/",
   "//third_party/openh264/src/codec/common/inc",
   "//third_party/openh264/src/codec/common/src",
